<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chronos & Logos: 9Rome Edition</title>
    <style>
        /* --- 1. SETTINGS & TYPOGRAPHY --- */
        :root {
            --bg-color: #0f1014;
            --sidebar-bg: #16181d;
            --text-primary: #ecf0f1;
            --text-secondary: #95a5a6;
            --accent: #d4af37; /* Gold */
            --accent-dim: rgba(212, 175, 55, 0.2);
            --card-bg: rgba(30, 35, 40, 0.8);
            --success: #27ae60;
            --error: #c0392b;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Georgia', 'Times New Roman', serif; /* Philosophical feel */
            background-color: var(--bg-color);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden; /* App-like structure */
            display: flex;
            flex-direction: column;
        }

        h1, h2, h3 { font-weight: normal; margin: 0; }
        p { font-family: 'Helvetica Neue', sans-serif; line-height: 1.6; }

        /* --- 2. HEADER --- */
        header {
            height: 60px;
            background: #000;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 100;
            flex-shrink: 0;
        }

        .brand {
            font-size: 1.2rem;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        select#topic-selector {
            background: #222;
            color: white;
            border: 1px solid #444;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.95rem;
            outline: none;
            width: 300px;
            transition: border-color 0.3s;
        }
        select#topic-selector:focus { border-color: var(--accent); }

        /* --- 3. LAYOUT CONTAINER --- */
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        /* --- 4. SIDEBAR (TIMELINE) --- */
        .timeline-sidebar {
            width: 280px;
            background: var(--sidebar-bg);
            border-right: 1px solid #333;
            overflow-y: auto;
            padding: 40px 20px;
            position: relative;
            flex-shrink: 0;
        }

        /* The Vertical Line */
        .timeline-sidebar::before {
            content: '';
            position: absolute;
            left: 30px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: #444;
        }

        .timeline-node {
            position: relative;
            padding-left: 40px;
            margin-bottom: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
        }

        .timeline-node:hover { opacity: 0.8; }
        
        .timeline-node.active {
            opacity: 1;
            transform: translateX(5px);
        }

        .node-dot {
            position: absolute;
            left: 26px; /* Align with line */
            top: 5px;
            width: 9px;
            height: 9px;
            background: var(--bg-color);
            border: 2px solid #666;
            border-radius: 50%;
            transition: all 0.3s;
            z-index: 2;
        }

        .timeline-node.active .node-dot {
            background: var(--accent);
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent);
            transform: scale(1.3);
        }

        .node-title {
            font-size: 1rem;
            font-weight: bold;
            display: block;
            color: var(--accent);
        }

        .node-era {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* --- 5. CONTENT AREA --- */
        .content-scroll-area {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 0 40px 100px 40px; /* Bottom padding for scroll space */
            background: radial-gradient(circle at 80% 20%, #2c3e50 0%, #0f1014 60%);
        }

        .intro-placeholder {
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: #555;
        }

        /* SECTION STYLING */
        section.idea-section {
            min-height: 90vh; /* Each section takes full screen */
            display: flex;
            flex-direction: column;
            justify-content: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 0;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .card-header {
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .card-header h2 { font-size: 2rem; margin-bottom: 5px; color: var(--text-primary); }
        .card-header .meta { color: var(--accent); font-size: 0.9rem; font-family: sans-serif; text-transform: uppercase; }

        .concept-block {
            margin-bottom: 30px;
        }
        .concept-title { color: var(--text-secondary); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 10px; }
        
        .life-context {
            background: rgba(212, 175, 55, 0.1); /* Gold tint */
            border-left: 3px solid var(--accent);
            padding: 15px;
            font-style: italic;
            margin: 20px 0;
            color: #f1c40f;
        }

        /* --- 6. INTERACTIVE WIDGETS --- */
        .widget-area {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        textarea.student-notes {
            width: 100%;
            background: #111;
            border: 1px solid #444;
            color: #ddd;
            padding: 15px;
            border-radius: 5px;
            min-height: 100px;
            font-family: 'Helvetica Neue', sans-serif;
            resize: vertical;
            box-sizing: border-box; /* Fix padding issue */
        }
        textarea.student-notes:focus { outline: 1px solid var(--accent); }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }

        button.btn {
            background: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button.btn:hover { background: #444; }

        button.btn-rec { background: #c0392b; }
        button.btn-rec:hover { background: #e74c3c; }
        button.btn-rec.recording { animation: pulse 1s infinite; background: #e74c3c; }

        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0); } }

        .save-indicator {
            font-size: 0.8rem;
            color: var(--success);
            opacity: 0;
            transition: opacity 0.5s;
            margin-left: auto;
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f1014; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

    </style>
</head>
<body>

<header>
    <div class="brand">‚ú¶ 9Rome: Chronos & Logos</div>
    <select id="topic-selector">
        <option value="" disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å...</option>
        <option value="universe">1. –ö–∞–∫ –∏ –ø–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–ª–∞ –í—Å–µ–ª–µ–Ω–Ω–∞—è?</option>
        <option value="god">2. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ë–æ–≥?</option>
        <option value="truth">3. –ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å—Ç–∏–Ω–∞?</option>
        <option value="spirit_matter">4. –ß—Ç–æ –ø–µ—Ä–≤–∏—á–Ω–æ: –¥—É—Ö –∏–ª–∏ –º–∞—Ç–µ—Ä–∏—è?</option>
        <option value="free_will">5. –°–≤–æ–±–æ–¥–∞ –≤–æ–ª–∏</option>
        <option value="good_evil">6. –î–æ–±—Ä–æ –∏ –∑–ª–æ (–≠—Ç–∏–∫–∞)</option>
        <option value="state">7. –ò–¥–µ–∞–ª—å–Ω–æ–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ</option>
        <option value="consciousness">8. –°–æ–∑–Ω–∞–Ω–∏–µ –∏ —Ç–µ–ª–æ</option>
        <option value="happiness">9. –ü—Ä–∏—Ä–æ–¥–∞ —Å—á–∞—Å—Ç—å—è</option>
        <option value="knowledge">10. –ü—Ä–µ–¥–µ–ª—ã –ø–æ–∑–Ω–∞–Ω–∏—è</option>
    </select>
</header>

<div class="main-container">
    <!-- Sidebar Navigation -->
    <div class="timeline-sidebar" id="sidebar">
        <!-- Nodes injected via JS -->
    </div>

    <!-- Content Area -->
    <div class="content-scroll-area" id="content-area">
        <div class="intro-placeholder">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é –∏–¥–µ–π.</h2>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å —Å–≤–µ—Ä—Ö—É, —á—Ç–æ–±—ã —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—É—é –ª–∏–Ω–∏—é.</p>
            <p style="font-size: 3rem; margin-top:20px; opacity:0.2;">‚è≥</p>
        </div>
    </div>
</div>

<script>
    /* --- 1. DATA REPOSITORY --- */
    // –ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö 10 —Ç–µ–º.
    // –î–ª—è –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏ –∫–æ–¥–∞ —è –¥–µ—Ç–∞–ª—å–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–ª 3 —Ç–µ–º—ã, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–º–µ—é—Ç —à–∞–±–ª–æ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, 
    // –∫–æ—Ç–æ—Ä—É—é –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –∫—É—Ä—Å–∞ 9Rome.

    const database = {
        universe: {
            title: "–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –í—Å–µ–ª–µ–Ω–Ω–æ–π",
            stages: [
                { id: "u1", figure: "–§–∞–ª–µ—Å –∏ –ù–∞—Ç—É—Ä—Ñ–∏–ª–æ—Å–æ—Ñ—ã", era: "VI –≤. –¥–æ –Ω.—ç.", desc: "–ê—Ä—Ö—ç. –ü–æ–∏—Å–∫ –ø–µ—Ä–≤–æ–≤–µ—â–µ—Å—Ç–≤–∞ (–≤–æ–¥–∞, –≤–æ–∑–¥—É—Ö, –æ–≥–æ–Ω—å). –û—Ç–∫–∞–∑ –æ—Ç –º–∏—Ñ–∞ –≤ –ø–æ–ª—å–∑—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.", context: "–ü–µ—Ä–≤—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—ä—è—Å–Ω–∏—Ç—å –ø—Ä–∏—Ä–æ–¥—É –∏–∑ —Å–∞–º–æ–π –ø—Ä–∏—Ä–æ–¥—ã, –±–µ–∑ –±–æ–≥–æ–≤.", question: "–ú–æ–∂–Ω–æ –ª–∏ —Å–≤–µ—Å—Ç–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–∏—Ä–∞ –∫ –æ–¥–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É?" },
                { id: "u2", figure: "–ü–ª–∞—Ç–æ–Ω (–¢–∏–º–µ–π)", era: "IV –≤. –¥–æ –Ω.—ç.", desc: "–î–µ–º–∏—É—Ä–≥ —Ç–≤–æ—Ä–∏—Ç –∫–æ—Å–º–æ—Å –∏–∑ —Ö–∞–æ—Å–∞, –≥–ª—è–¥—è –Ω–∞ –≤–µ—á–Ω—ã–µ –ò–¥–µ–∏. –ú–∞—Ç–µ—Ä–∏—è —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–µ—Ç—Å—è.", context: "–ö–æ—Å–º–æ—Å ‚Äî —ç—Ç–æ –∂–∏–≤–æ–π –æ—Ä–≥–∞–Ω–∏–∑–º, –Ω–∞–¥–µ–ª–µ–Ω–Ω—ã–π –¥—É—à–æ–π.", question: "–Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫—Ä–∞—Å–æ—Ç–∞ –º–∏—Ä–∞ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å—é –∏–ª–∏ –∑–∞–º—ã—Å–ª–æ–º?" },
                { id: "u3", figure: "–•—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫–∞—è –∫–æ—Å–º–æ–ª–æ–≥–∏—è", era: "–°—Ä–µ–¥–Ω–∏–µ –≤–µ–∫–∞", desc: "Creatio ex nihilo. –ë–æ–≥ —Ç–≤–æ—Ä–∏—Ç –º–∏—Ä –∏–∑ –ù–∏—á–µ–≥–æ –∞–∫—Ç–æ–º –≤–æ–ª–∏. –í—Ä–µ–º—è –ª–∏–Ω–µ–π–Ω–æ, –∞ –Ω–µ —Ü–∏–∫–ª–∏—á–Ω–æ.", context: "–ú–∏—Ä –Ω–µ –≤–µ—á–µ–Ω, —É –Ω–µ–≥–æ –µ—Å—Ç—å –ù–∞—á–∞–ª–æ –∏ –±—É–¥–µ—Ç –ö–æ–Ω–µ—Ü.", question: "–ß—Ç–æ –±—ã–ª–æ –¥–æ –Ω–∞—á–∞–ª–∞ –≤—Ä–µ–º–µ–Ω–∏?" },
                { id: "u4", figure: "–ë–æ–ª—å—à–æ–π –í–∑—Ä—ã–≤", era: "XX –≤–µ–∫", desc: "–°–∏–Ω–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å. –†–∞—Å—à–∏—Ä—è—é—â–∞—è—Å—è –í—Å–µ–ª–µ–Ω–Ω–∞—è. –§–∏–∑–∏–∫–∞ –æ–±—ä—è—Å–Ω—è–µ—Ç '–∫–∞–∫', –Ω–æ –º–æ–ª—á–∏—Ç –æ '–ø–æ—á–µ–º—É'.", context: "–ù–∞—É–∫–∞ –±–µ—Ä–µ—Ç –Ω–∞ —Å–µ–±—è —Ä–æ–ª—å –æ–ø–∏—Å–∞–Ω–∏—è –≥–µ–Ω–µ–∑–∏—Å–∞.", question: "–ú–æ–∂–µ—Ç –ª–∏ ¬´–Ω–∏—á—Ç–æ¬ª –ø–æ—Ä–æ–¥–∏—Ç—å ¬´–Ω–µ—á—Ç–æ¬ª –±–µ–∑ –≤–Ω–µ—à–Ω–µ–π –ø—Ä–∏—á–∏–Ω—ã?" },
                { id: "u5", figure: "9Rome: –°–∏–Ω—Ç–µ–∑", era: "–ó–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å", desc: "–í—Å–µ–ª–µ–Ω–Ω–∞—è –∫–∞–∫ —à–∫–æ–ª–∞ –¥—É—Ö–∞. –ú—ã ‚Äî —Å–ø–æ—Å–æ–± –∫–æ—Å–º–æ—Å–∞ –ø–æ–∑–Ω–∞—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è.", context: "–í–∞—à–µ –ª–∏—á–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ.", question: "–ß—É–≤—Å—Ç–≤—É–µ—Ç–µ –ª–∏ –≤—ã —Å–µ–±—è —á–∞—Å—Ç—å—é –≤—Å–µ–ª–µ–Ω—Å–∫–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞?" }
            ]
        },
        god: {
            title: "–°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ë–æ–≥?",
            stages: [
                { id: "g1", figure: "–ö—Å–µ–Ω–æ—Ñ–∞–Ω", era: "500 –¥–æ –Ω.—ç.", desc: "–ö—Ä–∏—Ç–∏–∫–∞ –∞–Ω—Ç—Ä–æ–ø–æ–º–æ—Ä—Ñ–∏–∑–º–∞. ¬´–ï—Å–ª–∏ –±—ã –±—ã–∫–∏ —Ä–∏—Å–æ–≤–∞–ª–∏ –±–æ–≥–æ–≤, –æ–Ω–∏ –±—ã–ª–∏ –±—ã –ø–æ—Ö–æ–∂–∏ –Ω–∞ –±—ã–∫–æ–≤¬ª. –ï–¥–∏–Ω—ã–π –ë–æ–≥ ‚Äî —ç—Ç–æ –£–º.", context: "–û—á–∏—â–µ–Ω–∏–µ –∏–¥–µ–∏ –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö —á–µ—Ä—Ç.", question: "–ú—ã —Å–æ–∑–¥–∞–µ–º –ë–æ–≥–∞ –ø–æ —Å–≤–æ–µ–º—É –æ–±—Ä–∞–∑—É –∏–ª–∏ –û–Ω –Ω–∞—Å?" },
                { id: "g2", figure: "–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—å", era: "350 –¥–æ –Ω.—ç.", desc: "–ü–µ—Ä–≤–æ–¥–≤–∏–≥–∞—Ç–µ–ª—å. –ë–æ–≥ ‚Äî —ç—Ç–æ —á–∏—Å—Ç–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ –º—ã—à–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º—ã—Å–ª–∏—Ç —Å–∞–º–æ —Å–µ–±—è. –û–Ω –Ω–µ –∑–∞–±–æ—Ç–∏—Ç—Å—è –æ –º–∏—Ä–µ, –Ω–æ –¥–≤–∏–∂–µ—Ç –∏–º –∫–∞–∫ –æ–±—ä–µ–∫—Ç –ª—é–±–≤–∏.", context: "–õ–æ–≥–∏—á–µ—Å–∫–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏—á–∏–Ω—ã –¥–≤–∏–∂–µ–Ω–∏—è.", question: "–ù—É–∂–µ–Ω –ª–∏ –º–∏—Ä—É –ë–æ–≥, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–ª—ã—à–∏—Ç –º–æ–ª–∏—Ç–≤?" },
                { id: "g3", figure: "–§–æ–º–∞ –ê–∫–≤–∏–Ω—Å–∫–∏–π", era: "1265 –≥.", desc: "–ü—è—Ç—å –ø—É—Ç–µ–π. –û—Ç –¥–≤–∏–∂–µ–Ω–∏—è, –æ—Ç –ø—Ä–∏—á–∏–Ω—ã, –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –æ—Ç —Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–∞, –æ—Ç —Ü–µ–ª–µ–ø–æ–ª–∞–≥–∞–Ω–∏—è.", context: "–ì–∞—Ä–º–æ–Ω–∏—è –≤–µ—Ä—ã (–æ—Ç–∫—Ä–æ–≤–µ–Ω–∏—è) –∏ —Ä–∞–∑—É–º–∞ (–ê—Ä–∏—Å—Ç–æ—Ç–µ–ª—è).", question: "–ö–∞–∫–æ–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –∫–∞–∂–µ—Ç—Å—è –≤–∞–º —Å–∞–º—ã–º —Å–∏–ª—å–Ω—ã–º?" },
                { id: "g4", figure: "–ù–∏—Ü—à–µ –∏ –°–º–µ—Ä—Ç—å –ë–æ–≥–∞", era: "XIX –≤–µ–∫", desc: "¬´–ë–æ–≥ –º–µ—Ä—Ç–≤¬ª. –ú—ã —É–±–∏–ª–∏ –µ–≥–æ, —Ä–∞–∑—Ä—É—à–∏–≤ —Å—Ç–∞—Ä—ã–µ —Ü–µ–Ω–Ω–æ—Å—Ç–∏. –¢–µ–ø–µ—Ä—å —á–µ–ª–æ–≤–µ–∫ –¥–æ–ª–∂–µ–Ω —Å–∞–º —Å—Ç–∞—Ç—å —Ç–≤–æ—Ä—Ü–æ–º —Å–º—ã—Å–ª–∞.", context: "–ö—Ä–∏–∑–∏—Å —Ä–µ–ª–∏–≥–∏–∏ –≤ –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–æ–º –æ–±—â–µ—Å—Ç–≤–µ.", question: "–í–æ–∑–º–æ–∂–Ω–∞ –ª–∏ –æ–±—ä–µ–∫—Ç–∏–≤–Ω–∞—è –º–æ—Ä–∞–ª—å –±–µ–∑ –≤—ã—Å—à–µ–≥–æ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è?" },
                { id: "g5", figure: "9Rome: –õ–∏—á–Ω–∞—è –í—Å—Ç—Ä–µ—á–∞", era: "–ó–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å", desc: "–ë–æ–≥ –Ω–µ –∫–∞–∫ –æ–±—ä–µ–∫—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞, –∞ –∫–∞–∫ –æ–ø—ã—Ç. –î–∏–∞–ª–æ–≥ —Å –ê–±—Å–æ–ª—é—Ç–æ–º.", context: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ –∏ –¥—É—Ö–æ–≤–Ω–æ–≥–æ –æ–ø—ã—Ç–∞.", question: "–ö—Ç–æ –¥–ª—è –≤–∞—Å –ë–æ–≥: –ó–∞–∫–æ–Ω, –õ–∏—á–Ω–æ—Å—Ç—å –∏–ª–∏ –ü—É—Å—Ç–æ—Ç–∞?" }
            ]
        },
        happiness: {
            title: "–ü—Ä–∏—Ä–æ–¥–∞ –°—á–∞—Å—Ç—å—è",
            stages: [
                { id: "h1", figure: "–°–æ–∫—Ä–∞—Ç", era: "–ê—Ñ–∏–Ω—ã", desc: "–°—á–∞—Å—Ç—å–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑ –¥–æ–±—Ä–æ–¥–µ—Ç–µ–ª–∏. –ù–∏–∫—Ç–æ –Ω–µ –¥–µ–ª–∞–µ—Ç –∑–ª–∞ –¥–æ–±—Ä–æ–≤–æ–ª—å–Ω–æ, —Ç–æ–ª—å–∫–æ –ø–æ –Ω–µ–≤–µ–¥–µ–Ω–∏—é.", context: "–°—á–∞—Å—Ç—å–µ –¥—É—à–∏ –≤–∞–∂–Ω–µ–µ –∑–¥–æ—Ä–æ–≤—å—è —Ç–µ–ª–∞.", question: "–õ—É—á—à–µ —Ç–µ—Ä–ø–µ—Ç—å –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å –∏–ª–∏ —Å–æ–≤–µ—Ä—à–∞—Ç—å –µ—ë?" },
                { id: "h2", figure: "–°—Ç–æ–∏–∫–∏", era: "–†–∏–º", desc: "–°—á–∞—Å—Ç—å–µ ‚Äî —ç—Ç–æ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Å—É–¥—å–±—ã. –¢–æ, —á—Ç–æ –Ω–µ –≤ –Ω–∞—à–µ–π –≤–ª–∞—Å—Ç–∏, –Ω–µ –¥–æ–ª–∂–Ω–æ –Ω–∞—Å —Ç—Ä–µ–≤–æ–∂–∏—Ç—å.", context: "–ñ–∏–∑–Ω—å –ø–æ–ª–Ω–∞ —Å—Ç—Ä–∞–¥–∞–Ω–∏–π, –≤—ã—Ö–æ–¥ ‚Äî –≤–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –∫—Ä–µ–ø–æ—Å—Ç–∏.", question: "–ú–æ–∂–µ—Ç –ª–∏ —Å—á–∞—Å—Ç–ª–∏–≤—ã–π —á–µ–ª–æ–≤–µ–∫ –±—ã—Ç—å —Ä–∞–±–æ–º –∏–ª–∏ –≤ —Ç—é—Ä—å–º–µ?" },
                { id: "h3", figure: "–û–±—â–µ—Å—Ç–≤–æ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è", era: "XXI –≤–µ–∫", desc: "–ì–µ–¥–æ–Ω–∏–∑–º. –°—á–∞—Å—Ç—å–µ = —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ + —É—Å–ø–µ—Ö + –∫–æ–º—Ñ–æ—Ä—Ç.", context: "–ö—É–ª—å—Ç –≤–µ—á–Ω–æ–π –º–æ–ª–æ–¥–æ—Å—Ç–∏ –∏ –ø–æ–∑–∏—Ç–∏–≤–∞.", question: "–ü–æ—á–µ–º—É –¥–µ–ø—Ä–µ—Å—Å–∏—è —Ä–∞—Å—Ç–µ—Ç –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –∫–æ–º—Ñ–æ—Ä—Ç–∞?" },
                { id: "h4", figure: "9Rome: –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å", era: "–°–µ–π—á–∞—Å", desc: "–°—á–∞—Å—Ç—å–µ –∫–∞–∫ —Ä–µ–∑–æ–Ω–∞–Ω—Å. –ö–æ–≥–¥–∞ –º—ã—Å–ª–∏, —á—É–≤—Å—Ç–≤–∞ –∏ –¥–µ–π—Å—Ç–≤–∏—è –µ–¥–∏–Ω—ã.", context: "–†–∞–±–æ—Ç–∞ –Ω–∞–¥ —Å–æ–±–æ–π.", question: "–ö–æ–≥–¥–∞ –≤—ã –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ –ø–æ–¥–ª–∏–Ω–Ω–æ–µ —Å—á–∞—Å—Ç—å–µ?" }
            ]
        },
        // –®–∞–±–ª–æ–Ω–Ω—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ–º, —á—Ç–æ–±—ã –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–ª
        truth: { title: "–ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å—Ç–∏–Ω–∞?", stages: getGenericStages("–ò—Å—Ç–∏–Ω–∞") },
        spirit_matter: { title: "–î—É—Ö –∏ –ú–∞—Ç–µ—Ä–∏—è", stages: getGenericStages("–î—É—Ö/–ú–∞—Ç–µ—Ä–∏—è") },
        free_will: { title: "–°–≤–æ–±–æ–¥–∞ –í–æ–ª–∏", stages: getGenericStages("–í–æ–ª—è") },
        good_evil: { title: "–î–æ–±—Ä–æ –∏ –ó–ª–æ", stages: getGenericStages("–≠—Ç–∏–∫–∞") },
        state: { title: "–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–æ", stages: getGenericStages("–ü–æ–ª–∏—Ç–∏–∫–∞") },
        consciousness: { title: "–°–æ–∑–Ω–∞–Ω–∏–µ", stages: getGenericStages("–°–æ–∑–Ω–∞–Ω–∏–µ") },
        knowledge: { title: "–ì—Ä–∞–Ω–∏—Ü—ã –ø–æ–∑–Ω–∞–Ω–∏—è", stages: getGenericStages("–ì–Ω–æ—Å–µ–æ–ª–æ–≥–∏—è") }
    };

    function getGenericStages(topicName) {
        return [
            { id: "gen1", figure: "–î—Ä–µ–≤–Ω–∏–µ", era: "–ê–Ω—Ç–∏—á–Ω–æ—Å—Ç—å", desc: `–ö–∞–∫ ${topicName} –ø–æ–Ω–∏–º–∞–ª–∞—Å—å –Ω–∞ –∑–∞—Ä–µ —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏.`, context: "–ú–∏—Ñ–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ.", question: "–° —á–µ–≥–æ –Ω–∞—á–∞–ª—Å—è —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?" },
            { id: "gen2", figure: "–ö–ª–∞—Å—Å–∏–∫–∞", era: "–ó–æ–ª–æ—Ç–æ–π –≤–µ–∫", desc: `–°–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ–º–µ ${topicName}.`, context: "–†–∞—Å—Ü–≤–µ—Ç —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏.", question: "–í —á–µ–º —Å–∏–ª–∞ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞?" },
            { id: "gen3", figure: "–ú–æ–¥–µ—Ä–Ω", era: "–ù–æ–≤–æ–µ –≤—Ä–µ–º—è", desc: `–ù–∞—É—á–Ω—ã–π –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç –∏ –∫—Ä–∏—Ç–∏–∫–∞ —Ç–µ–º—ã ${topicName}.`, context: "–†–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–º –∏ —Å–æ–º–Ω–µ–Ω–∏–µ.", question: "–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–∞ –Ω–∞—É–∫–∞?" },
            { id: "gen4", figure: "9Rome", era: "–°–∏–Ω—Ç–µ–∑", desc: "–í–∞—à–µ –ª–∏—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –∏—Ç–æ–≥ –∫—É—Ä—Å–∞.", context: "–õ–∏—á–Ω—ã–π –æ–ø—ã—Ç.", question: "–í–∞—à –≤—ã–≤–æ–¥?" }
        ];
    }

    /* --- 2. CORE LOGIC --- */
    
    const selector = document.getElementById('topic-selector');
    const sidebar = document.getElementById('sidebar');
    const contentArea = document.getElementById('content-area');
    let currentData = null;

    // Observer setup (Highlights sidebar nodes on scroll)
    const observerOptions = {
        root: contentArea,
        threshold: 0.5 // Trigger when 50% of section is visible
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                activateSidebarNode(entry.target.id);
            }
        });
    }, observerOptions);

    selector.addEventListener('change', (e) => {
        const topicKey = e.target.value;
        loadTopic(topicKey);
    });

    function loadTopic(key) {
        currentData = database[key];
        
        // Clear containers
        sidebar.innerHTML = '';
        contentArea.innerHTML = '';

        // Generate UI
        currentData.stages.forEach((stage, index) => {
            // 1. Sidebar Node
            const node = document.createElement('div');
            node.className = 'timeline-node';
            node.dataset.targetId = `section-${index}`;
            node.innerHTML = `
                <div class="node-dot"></div>
                <span class="node-title">${stage.figure}</span>
                <span class="node-era">${stage.era}</span>
            `;
            node.onclick = () => {
                document.getElementById(`section-${index}`).scrollIntoView({ behavior: 'smooth' });
            };
            sidebar.appendChild(node);

            // 2. Content Section
            const section = document.createElement('section');
            section.className = 'idea-section';
            section.id = `section-${index}`;
            
            // Load saved note
            const savedNote = localStorage.getItem(`9rome_${key}_${index}`) || '';

            section.innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <div class="meta">${stage.era} ‚Äî ${stage.figure}</div>
                        <h2>${stage.desc.split('.')[0]}...</h2> 
                    </div>
                    
                    <div class="concept-block">
                        <div class="concept-title">–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è</div>
                        <p>${stage.desc}</p>
                    </div>

                    <div class="life-context">
                        <strong>–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:</strong> ${stage.context}
                    </div>

                    <div class="widget-area">
                        <div class="concept-title">üèõ –í–æ–ø—Ä–æ—Å –¥–ª—è —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è (9Rome)</div>
                        <p style="font-size: 1.1rem; margin-bottom: 15px;">${stage.question}</p>
                        
                        <textarea class="student-notes" 
                            placeholder="–í–∞—à–∏ –º—ã—Å–ª–∏... (–∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)"
                            oninput="saveNote('${key}', ${index}, this)">${savedNote}</textarea>
                        
                        <div class="audio-controls">
                            <button class="btn btn-rec" id="rec-btn-${index}" onclick="toggleRecord(this, ${index})">
                                <span>üéô</span> <span class="text">–ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç</span>
                            </button>
                            <div id="audio-player-${index}" style="flex-grow:1;"></div>
                            <span class="save-indicator" id="save-msg-${index}">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</span>
                        </div>
                    </div>
                </div>
            `;
            contentArea.appendChild(section);
            observer.observe(section);
        });
    }

    function activateSidebarNode(sectionId) {
        const index = sectionId.split('-')[1];
        // Remove active class from all
        document.querySelectorAll('.timeline-node').forEach(n => n.classList.remove('active'));
        // Add to current
        const nodes = document.querySelectorAll('.timeline-node');
        if (nodes[index]) nodes[index].classList.add('active');
    }

    function saveNote(topic, index, textarea) {
        localStorage.setItem(`9rome_${topic}_${index}`, textarea.value);
        const ind = document.getElementById(`save-msg-${index}`);
        ind.style.opacity = 1;
        setTimeout(() => ind.style.opacity = 0, 1500);
    }

    /* --- 3. AUDIO LOGIC (Browser API) --- */
    let mediaRecorder = null;
    let audioChunks = [];
    let activeRecIndex = null;

    async function toggleRecord(btn, index) {
        // If recording is active somewhere else, stop it
        if (activeRecIndex !== null && activeRecIndex !== index) {
            alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≤–µ—Ä—à–∏—Ç–µ —Ç–µ–∫—É—â—É—é –∑–∞–ø–∏—Å—å.");
            return;
        }

        if (btn.classList.contains('recording')) {
            // STOP
            mediaRecorder.stop();
            btn.classList.remove('recording');
            btn.querySelector('.text').innerText = "–ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç";
            activeRecIndex = null;
        } else {
            // START
            // Check for HTTPS or Localhost (Browser security requirement)
            if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.href.indexOf('file://') === -1) {
                alert("–í–Ω–∏–º–∞–Ω–∏–µ: –ë—Ä–∞—É–∑–µ—Ä—ã —Ä–∞–∑—Ä–µ—à–∞—é—Ç –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É —Ç–æ–ª—å–∫–æ –ø–æ HTTPS –∏–ª–∏ –Ω–∞ localhost. –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –Ω–µ –Ω–∞—á–Ω–µ—Ç—Å—è, —ç—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞.");
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                activeRecIndex = index;

                mediaRecorder.ondataavailable = event => audioChunks.push(event.data);
                
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const container = document.getElementById(`audio-player-${index}`);
                    
                    // Create Audio Element + Download Link
                    container.innerHTML = `
                        <audio controls src="${audioUrl}" style="height:35px; width:100%; vertical-align:middle;"></audio>
                        <a href="${audioUrl}" download="9rome_audio_${index}.webm" style="color:#aaa; font-size:0.8rem; margin-left:10px;">–°–∫–∞—á–∞—Ç—å</a>
                    `;
                };

                mediaRecorder.start();
                btn.classList.add('recording');
                btn.querySelector('.text').innerText = "–°—Ç–æ–ø (–ó–∞–ø–∏—Å—å –∏–¥–µ—Ç...)";

            } catch (err) {
                console.error(err);
                alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: " + err.message);
            }
        }
    }

</script>
</body>
</html>